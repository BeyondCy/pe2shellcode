// 90_shellcode.cpp : Defines the entry point for the application.
//

#include "stdafx.h"
#include "90_shellcode.h"

void import_table()
{
	HMODULE hMod = LoadLibraryA("User32.dll");
	hMod = LoadLibraryA("ADVAPI32.dll");

}

int  main()
{
    LoadLibraryA("User32.dll");
	LoadLibraryA("ADVAPI32.dll");
	LoadLibraryA("WS2_32.dll");

	
    HANDLE hHeap = HeapCreate(HEAP_CREATE_ENABLE_EXECUTE, 1024, 0);
    PVOID pMem = HeapAlloc(hHeap, HEAP_ZERO_MEMORY, 1024 * 1024 * 20);
	ZeroMemory(pMem,  1024 * 1024 * 20);
    pMem = (PVOID)((int)pMem + 16);
   // unsigned char shellcode0[] =
    //{ 
      //  232, 0, 0, 0, 0, 94, 139, 254, 129, 198, 161, 5, 0, 0, 185, 12, 0, 0, 0, 252, 173, 1, 60, 7, 226, 250, 85, 139, 236, 131, 236, 20, 106, 0, 104, 205, 2, 0, 0, 104, 221, 2, 0, 0, 106, 0, 255, 21, 137, 2, 0, 0, 106, 0, 104, 237, 2, 0, 0, 104, 245, 2, 0, 0, 106, 0, 255, 21, 133, 2, 0, 0, 232, 106, 0, 0, 0, 137, 69, 252, 198, 69, 236, 77, 198, 69, 237, 101, 198, 69, 238, 115, 198, 69, 239, 115, 198, 69, 240, 97, 198, 69, 241, 103, 198, 69, 242, 101, 198, 69, 243, 66, 198, 69, 244, 111, 198, 69, 245, 120, 198, 69, 246, 65, 104, 253, 2, 0, 0, 255, 117, 252, 232, 199, 0, 0, 0, 89, 89, 137, 69, 248, 255, 53, 125, 2, 0, 0, 104, 105, 2, 0, 0, 104, 113, 2, 0, 0, 106, 0, 255, 85, 248, 15, 182, 5, 111, 2, 0, 0, 163, 121, 2, 0, 0, 51, 192, 139, 229, 93, 194, 4, 0, 85, 139, 236, 81, 83, 86, 87, 96, 100, 161, 48, 0, 0, 0, 137, 69, 252, 97, 139, 69, 252, 95, 94, 91, 139, 229, 93, 195, 85, 139, 236, 81, 81, 131, 101, 248, 0, 198, 69, 255, 1, 235, 7, 139, 69, 248, 64, 137, 69, 248, 139, 69, 8, 3, 69, 248, 15, 190, 0, 133, 192, 117, 15, 139, 69, 12, 3, 69, 248, 15, 190, 0, 133, 192, 117, 2, 235, 68, 139, 69, 8, 3, 69, 248, 15, 190, 0, 133, 192, 116, 47, 139, 69, 12, 3, 69, 248, 15, 190, 0, 133, 192, 116, 34, 139, 69, 8, 3, 69, 248, 15, 190, 0, 139, 77, 12, 3, 77, 248, 15, 190, 9, 59, 193, 117, 4, 235, 171, 235, 6, 198, 69, 255, 0, 235, 10, 235, 6, 198, 69, 255, 0, 235, 2, 235, 153, 138, 69, 255, 139, 229, 93, 195, 85, 139, 236, 131, 236, 60, 139, 69, 8, 137, 69, 224, 139, 69, 224, 139, 64, 12, 139, 64, 20, 137, 69, 228, 139, 69, 228, 137, 69, 236, 139, 69, 236, 131, 232, 8, 137, 69, 220, 139, 69, 236, 139, 0, 137, 69, 236, 139, 69, 220, 139, 64, 24, 137, 69, 248, 131, 125, 248, 0, 117, 5, 233, 187, 0, 0, 0, 139, 69, 248, 137, 69, 216, 139, 69, 216, 139, 77, 248, 3, 72, 60, 137, 77, 212, 106, 8, 88, 107, 192, 0, 139, 77, 212, 139, 68, 1, 120, 137, 69, 232, 131, 125, 232, 0, 117, 5, 233, 142, 0, 0, 0, 139, 69, 248, 3, 69, 232, 137, 69, 240, 139, 69, 240, 139, 77, 248, 3, 72, 12, 137, 77, 196, 139, 69, 240, 139, 77, 248, 3, 72, 32, 137, 77, 208, 131, 101, 244, 0, 235, 7, 139, 69, 244, 64, 137, 69, 244, 139, 69, 240, 139, 77, 244, 59, 72, 24, 115, 85, 139, 69, 244, 139, 77, 208, 139, 85, 248, 3, 20, 129, 137, 85, 204, 255, 117, 12, 255, 117, 204, 232, 192, 254, 255, 255, 89, 89, 15, 182, 192, 131, 248, 1, 117, 47, 139, 69, 240, 139, 77, 248, 3, 72, 36, 139, 69, 244, 102, 139, 4, 65, 102, 137, 69, 252, 139, 69, 240, 139, 77, 248, 3, 72, 28, 15, 183, 69, 252, 139, 4, 129, 137, 69, 200, 139, 69, 248, 3, 69, 200, 235, 16, 235, 153, 139, 69, 236, 59, 69, 228, 15, 133, 20, 255, 255, 255, 51, 192, 139, 229, 93, 195, 85, 139, 236, 106, 0, 232, 176, 253, 255, 255, 51, 192, 93, 195, 116, 105, 116, 108, 101, 0, 8, 0, 116, 101, 120, 116, 0, 0, 0, 0, 0, 240, 240, 240, 4, 0, 0, 0, 0, 0, 0, 0, 230, 253, 26, 117, 7, 254, 26, 117, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 107, 178, 202, 86, 0, 0, 0, 0, 2, 0, 0, 0, 72, 0, 0, 0, 132, 32, 0, 0, 132, 8, 0, 0, 0, 0, 0, 0, 107, 178, 202, 86, 0, 0, 0, 0, 12, 0, 0, 0, 20, 0, 0, 0, 204, 32, 0, 0, 204, 8, 0, 0, 77, 0, 83, 0, 71, 0, 66, 0, 79, 0, 88, 0, 87, 0, 0, 0, 77, 0, 83, 0, 71, 0, 66, 0, 79, 0, 88, 0, 87, 0, 0, 0, 77, 83, 71, 66, 79, 88, 65, 0, 77, 83, 71, 66, 79, 88, 65, 0, 77, 101, 115, 115, 97, 103, 101, 66, 111, 120, 65, 0, 82, 83, 68, 83, 172, 58, 32, 175, 13, 54, 219, 79, 136, 41, 19, 221, 200, 156, 97, 238, 1, 0, 0, 0, 68, 58, 92, 57, 48, 95, 115, 104, 101, 108, 108, 99, 111, 100, 101, 92, 82, 101, 108, 101, 97, 115, 101, 92, 115, 104, 101, 108, 108, 99, 111, 100, 101, 95, 102, 114, 97, 109, 101, 119, 111, 114, 107, 46, 112, 100, 98, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 33, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 48, 33, 0, 0, 0, 32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 34, 33, 0, 0, 20, 33, 0, 0, 0, 0, 0, 0, 77, 2, 77, 101, 115, 115, 97, 103, 101, 66, 111, 120, 87, 0, 70, 2, 77, 101, 115, 115, 97, 103, 101, 66, 111, 120, 65, 0, 85, 83, 69, 82, 51, 50, 46, 100, 108, 108, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 24, 0, 0, 0, 24, 0, 0, 128, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 48, 0, 0, 128, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 9, 4, 0, 0, 72, 0, 0, 0, 96, 64, 0, 0, 125, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 60, 63, 120, 109, 108, 32, 118, 101, 114, 115, 105, 111, 110, 61, 39, 49, 46, 48, 39, 32, 101, 110, 99, 111, 100, 105, 110, 103, 61, 39, 85, 84, 70, 45, 56, 39, 32, 115, 116, 97, 110, 100, 97, 108, 111, 110, 101, 61, 39, 121, 101, 115, 39, 63, 62, 13, 10, 60, 97, 115, 115, 101, 109, 98, 108, 121, 32, 120, 109, 108, 110, 115, 61, 39, 117, 114, 110, 58, 115, 99, 104, 101, 109, 97, 115, 45, 109, 105, 99, 114, 111, 115, 111, 102, 116, 45, 99, 111, 109, 58, 97, 115, 109, 46, 118, 49, 39, 32, 109, 97, 110, 105, 102, 101, 115, 116, 86, 101, 114, 115, 105, 111, 110, 61, 39, 49, 46, 48, 39, 62, 13, 10, 32, 32, 60, 116, 114, 117, 115, 116, 73, 110, 102, 111, 32, 120, 109, 108, 110, 115, 61, 34, 117, 114, 110, 58, 115, 99, 104, 101, 109, 97, 115, 45, 109, 105, 99, 114, 111, 115, 111, 102, 116, 45, 99, 111, 109, 58, 97, 115, 109, 46, 118, 51, 34, 62, 13, 10, 32, 32, 32, 32, 60, 115, 101, 99, 117, 114, 105, 116, 121, 62, 13, 10, 32, 32, 32, 32, 32, 32, 60, 114, 101, 113, 117, 101, 115, 116, 101, 100, 80, 114, 105, 118, 105, 108, 101, 103, 101, 115, 62, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 60, 114, 101, 113, 117, 101, 115, 116, 101, 100, 69, 120, 101, 99, 117, 116, 105, 111, 110, 76, 101, 118, 101, 108, 32, 108, 101, 118, 101, 108, 61, 39, 97, 115, 73, 110, 118, 111, 107, 101, 114, 39, 32, 117, 105, 65, 99, 99, 101, 115, 115, 61, 39, 102, 97, 108, 115, 101, 39, 32, 47, 62, 13, 10, 32, 32, 32, 32, 32, 32, 60, 47, 114, 101, 113, 117, 101, 115, 116, 101, 100, 80, 114, 105, 118, 105, 108, 101, 103, 101, 115, 62, 13, 10, 32, 32, 32, 32, 60, 47, 115, 101, 99, 117, 114, 105, 116, 121, 62, 13, 10, 32, 32, 60, 47, 116, 114, 117, 115, 116, 73, 110, 102, 111, 62, 13, 10, 60, 47, 97, 115, 115, 101, 109, 98, 108, 121, 62, 13, 10, 0, 0, 0, 30, 0, 0, 0, 35, 0, 0, 0, 43, 0, 0, 0, 50, 0, 0, 0, 55, 0, 0, 0, 63, 0, 0, 0, 120, 0, 0, 0, 139, 0, 0, 0, 144, 0, 0, 0, 149, 0, 0, 0, 161, 0, 0, 0, 166, 0, 0, 0
	//};
   // memcpy_s(pMem, 1024*1024, shellcode0, sizeof(shellcode0));

	HANDLE hFile = CreateFile(L"E:\\shellcode.bin",
		GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);
	LARGE_INTEGER ll_shellcode_size; 
    GetFileSizeEx(hFile, &ll_shellcode_size);
	DWORD dwRead = 0;
	ReadFile(hFile, (PVOID)((int)pMem+1), ll_shellcode_size.LowPart, &dwRead, NULL);
	memset(pMem, 0xcc, 1);
	CloseHandle(hFile);
	if (dwRead != ll_shellcode_size.LowPart)
		return 0;
    HANDLE hThread0 = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)pMem, NULL, 0, NULL);
    //HANDLE hThread = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)pShellcode, NULL, 0, NULL);
    Sleep(INFINITE);
    return 0;
}
